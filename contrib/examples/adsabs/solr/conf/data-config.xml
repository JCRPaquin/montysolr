<dataConfig>
    <script><![CDATA[
            function pubdate_sort(row) {
            	var date_string = row.get('pubdate');
            	row.put('pubdate_sort', date_string.replace('-', ''));
            	return row
            }
            function bibstem(row) {
            	var bibcode = row.get('bibcode');
            	row.put('bibstem', bibcode.substr(4,5));
            	return row;
            }
            function year(row) {
                var pubdate = row.get('pubdate');
                row.put('year', pubdate.substr(0,4));
                return row;
            }
    ]]></script>
    <dataSource type="AdsDataSource" mongoHost="adszee" mongoPort="27017" jdbcConfig="" />
    <document>
        <entity name="adsabs"
            pk="id"
            url="${dataimporter.request.url}"
            processor="XPathEntityProcessor"
            transformer="TemplateTransformer,script:year,script:pubdate_sort,script:bibstem,DateFormatTransformer"
            forEach="/collection/record"
            flatten="false"
            >
        
        <field column="id" 
            xpath="/collection/record/controlfield[@tag='001']" />
            
        <field column="bibcode" 
            xpath="/collection/record/datafield[@tag='970']/subfield[@code='a']" />
            
        <field column="reportnumber"        
            xpath="/collection/record/datafield[@tag='037']/subfield[@code='a']" />
            
        <field column="author"        
            xpath="/collection/record/datafield[@tag='700']/subfield[@code='a']" />
        <field column="author_norm"        
            xpath="/collection/record/datafield[@tag='700']/subfield[@code='b']" />   
        <field column="aff"        
            xpath="/collection/record/datafield[@tag='700']/subfield[@code='u']" />   

        <field column="abs"        
            xpath="/collection/record/datafield[@tag='520']/subfield[@code='a']" />

        <field column="title"        
            xpath="/collection/record/datafield[@tag='245']/subfield[@code='a']" />
        <field column="title"        
            xpath="/collection/record/datafield[@tag='242']/subfield[@code='a']" />      
        
        <field column="pub"        
            xpath="/collection/record/datafield[@tag='773']/subfield" />
        
        <field column="collection"        
            xpath="/collection/record/datafield[@tag='980']/subfield[@code='a']" />

        <field column="collection_type"        
            xpath="/collection/record/datafield[@tag='690']/subfield[@code='a']" />

        <field column="topic"        
            xpath="/collection/record/datafield[@tag='653']/subfield[@code='a']" />
            
        <!--
        <field column="year"        
            xpath="/collection/record/datafield[@tag='260']/subfield[@code='c']" />
        -->

        <field column="pubdate" 
            xpath="/collection/record/datafield[@tag='260']/subfield[@code='c']" />
            
        <!-- field column="entdate" xpath="" / -->
        <!-- field column="bibgroup" xpath="" / -->
            
        <field column="full" template="${adsabs.bibcode}"/>
        
        <field column="ack" template="${adsabs.bibcode}" />
        
        <field column="reader" template="${adsabs.bibcode}" />

        </entity>
        
    </document>
</dataConfig>
